---
import regionalData from '@/data/regional-data.json';
const initialData = regionalData.regional.progress;
---

<section class="bg-amber-50 rounded-lg border border-black-light4 p-6" id="progres">
    <!-- Header -->
    <h2 class="text-[#1a3a5c] font-bold text-lg mb-4">PROGRES PEMULIHAN</h2>
    
    <!-- Progress List -->
    <div class="divide-y divide-gray-200">
        <div class="flex justify-between items-center py-3">
            <span class="text-gray-700">Restorasi Rumah Sakit</span>
            <span class="text-gray-700"><span class="font-bold" id="progress-rs">{initialData.restorasiRumahSakit}</span> Unit</span>
        </div>
        <div class="flex justify-between items-center py-3">
            <span class="text-gray-700">RS Beroperasi</span>
            <span class="text-gray-700"><span class="font-bold" id="progress-rs-op">{initialData.rsOperasional}</span> Unit</span>
        </div>
        <div class="flex justify-between items-center py-3">
            <span class="text-gray-700">Restorasi Rumah tinggal</span>
            <span class="text-gray-700"><span class="font-bold" id="progress-rumah">{initialData.restorasiRumahTinggal.toLocaleString()}</span> Unit</span>
        </div>
        <div class="flex justify-between items-center py-3">
            <span class="text-gray-700">Restorasi Sekolah</span>
            <span class="text-gray-700"><span class="font-bold" id="progress-sekolah">{initialData.restorasiSekolah}</span> Sekolah</span>
        </div>
        <div class="flex justify-between items-center py-3">
            <span class="text-gray-700">Restorasi Jembatan</span>
            <span class="text-gray-700"><span class="font-bold" id="progress-jembatan">{initialData.restorasiJembatan}</span> Jembatan</span>
        </div>
        <div class="flex justify-between items-center py-3">
            <span class="text-gray-700">Restorasi Puskesmas</span>
            <span class="text-gray-700"><span class="font-bold" id="progress-puskesmas">{initialData.restorasiPuskesmas}</span> Unit</span>
        </div>
        <div class="flex justify-between items-center py-3">
            <span class="text-gray-700">Puskesmas Operasional</span>
            <span class="text-gray-700"><span class="font-bold" id="progress-puskesmas-op">{initialData.puskesmasOperasional}</span> Unit</span>
        </div>
        <div class="flex justify-between items-center py-3">
            <span class="text-gray-700">Restorasi Gedung Pemerintah</span>
            <span class="text-gray-700"><span class="font-bold" id="progress-gedung">{initialData.restorasiGedungPemerintah}</span> Unit</span>
        </div>
    </div>
    
    <!-- Info Note -->
    <div class="mt-4 bg-amber-100 border-l-4 border-amber-400 p-3">
        <p class="text-sm text-amber-800 italic">
            Data menunjukkan kemajuan pemulihan infrastruktur vital yang signifikan dalam 24 jam terakhir.
        </p>
    </div>
</section>

<script define:vars={{ regionalData }}>
    // Function to update progress data display
    function updateProgressData(level, provinceName = null, regencyName = null) {
        let data;
        
        if (level === 'regional') {
            data = regionalData.regional.progress;
        } else if (level === 'province' && provinceName) {
            data = regionalData.provinces[provinceName]?.progress || regionalData.regional.progress;
        } else if (level === 'regency' && regencyName) {
            data = regionalData.regencies[regencyName]?.progress || regionalData.regional.progress;
        } else {
            data = regionalData.regional.progress;
        }
        
        // Update all elements
        document.getElementById('progress-rs').textContent = data.restorasiRumahSakit.toLocaleString();
        document.getElementById('progress-rs-op').textContent = data.rsOperasional.toLocaleString();
        document.getElementById('progress-rumah').textContent = data.restorasiRumahTinggal.toLocaleString();
        document.getElementById('progress-sekolah').textContent = data.restorasiSekolah.toLocaleString();
        document.getElementById('progress-jembatan').textContent = data.restorasiJembatan.toLocaleString();
        document.getElementById('progress-puskesmas').textContent = data.restorasiPuskesmas.toLocaleString();
        document.getElementById('progress-puskesmas-op').textContent = data.puskesmasOperasional.toLocaleString();
        document.getElementById('progress-gedung').textContent = data.restorasiGedungPemerintah.toLocaleString();
    }
    
    // Listen for region data update events from map
    window.addEventListener('region-data-update', (e) => {
        const { level, province, regency } = e.detail;
        updateProgressData(level, province, regency);
    });
</script>